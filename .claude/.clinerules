# MoaDream Server v1 - Claude Code 규칙

## 언어 설정
- **응답 언어**: 항상 한국어로 응답
- **코드 주석**: 한국어
- **커밋 메시지**: 한국어
- **문서**: 한국어
- **변수/메서드명**: 영어 (명확한 의미 전달)

## 프로젝트 구조
- Domain-Driven Design (DDD) 구조 따르기
- 도메인별로 entity/repository/service/controller 패키지 분리
- global 패키지는 공통 기능만 포함

## 코딩 스타일

### Java 코드
- 들여쓰기: 4칸 스페이스
- 줄 길이: 120자 제한
- Lombok 적극 활용
- Builder 패턴 사용
- final 키워드 적절히 사용

### 엔티티 작성
```java
@Entity
@Table(name = "테이블명")
@Getter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@AllArgsConstructor(access = AccessLevel.PRIVATE)
@Builder
@EntityListeners(AuditingEntityListener.class)
public class EntityName {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    // 필드들...

    @CreatedDate
    @Column(nullable = false, updatable = false)
    private LocalDateTime createdAt;

    @LastModifiedDate
    private LocalDateTime updatedAt;
}
```

### 서비스 작성
```java
@Service
@RequiredArgsConstructor
@Slf4j
public class SomeService {

    private final SomeRepository someRepository;

    @Transactional
    public SomeResponse createSomething(SomeRequest request) {
        // 비즈니스 로직
    }

    @Transactional(readOnly = true)
    public SomeResponse getSomething(Long id) {
        // 조회 로직
    }
}
```

### 컨트롤러 작성
```java
@RestController
@RequestMapping("/api/v1/something")
@RequiredArgsConstructor
@Tag(name = "API 그룹명", description = "설명")
public class SomeController {

    private final SomeService someService;

    @PostMapping
    @Operation(summary = "생성", description = "상세 설명")
    @ApiResponse(responseCode = "200", description = "성공")
    public ApiResponse<SomeResponse> create(@RequestBody SomeRequest request) {
        return ApiResponse.success(someService.createSomething(request));
    }
}
```

## 네이밍 규칙
- 클래스: PascalCase (UserService)
- 메서드: camelCase (getUserById)
- 변수: camelCase (totalAmount)
- 상수: UPPER_SNAKE_CASE (MAX_RETRY_COUNT)
- 패키지: lowercase (com.nextech.moadream)

## Git 커밋 메시지
- feat: 새로운 기능 추가
- fix: 버그 수정
- refactor: 코드 리팩토링
- docs: 문서 수정
- test: 테스트 코드 추가/수정
- chore: 기타 변경사항

예시: "feat: 사용자 회원가입 API 추가"

## API 설계
- RESTful 원칙 준수
- HTTP 메서드 적절히 사용 (GET, POST, PUT, DELETE)
- 응답은 ApiResponse<T> 래퍼 사용
- 에러는 커스텀 예외 + GlobalExceptionHandler
- Swagger 문서화 필수

## 테스트
- JUnit 5 사용
- Given-When-Then 패턴
- Mockito로 의존성 모킹
- 테스트 메서드명은 한글 가능: "회원가입_성공"

## 데이터베이스
- JPA 사용
- 엔티티 관계는 단방향 선호
- 지연 로딩(LAZY) 기본 사용
- N+1 문제 주의 (fetch join 활용)
- 생성/수정 시간은 JPA Auditing 사용

## 보안
- JWT 토큰 기반 인증
- 비밀번호는 BCrypt 암호화
- 민감 정보는 환경변수로 관리
- API 호출 시 인증 검증

## 로깅
- Lombok @Slf4j 사용
- INFO: 중요한 비즈니스 로직
- ERROR: 예외 상황 (스택 트레이스 포함)
- DEBUG: 개발 중 디버깅 정보

## 주의사항
- null 체크 철저히
- Optional 적절히 활용
- 트랜잭션 범위 명확히
- 예외 처리 누락 금지
- 개인정보 처리 시 PrivacyLog 생성